<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html {
            padding: 40px;
            font-family: Arial;
            font-size: 20px;
        }

        .btn {
            background-color: red;
            border-radius: 10px;
            text-align: center;
            width: 140px;
            padding: 15px;
            margin: 0 auto;
            color: #ffffff;
            cursor: pointer;
        }
        .btn:hover {
            background-color: darkred;
        }
        #messege {
            text-align: center;
        }
        #gameboard {
            text-align: center;
        }
        .gameTile {
            display: inline-block;
        }
        .flipImage {
            max-width: 200px;
            padding: 2px;
        }
        #score {
            text-align: center;
            padding: 30px 0;
        }
    </style>
</head>
<body>
    <div id="output" style="text-align: center; margin-bottom: 100px"><h1>JavaScript Course</h1></div>
    <div id="wrapper">
        <div id="start" class="btn">Start Game</div>
        <div id="messege"><h2></h2></div>
        <div id="score"></div>
        <div id="gameboard"></div>
    </div>

    <script>
        // on/off switches
        var playLockOut = false;
        var gamePlay    = false;
        var flippedCard = -1;
        var timer;
        var totalTry = 0;
        var trys = 0;
        var points = 0;
        // all divs id's
        var start       = document.getElementById('start');
        var messege     = document.getElementById('messege');
        var score       = document.getElementById('score');
        var gameBoard   = document.getElementById('gameboard');

        // generate tiles Arrays
        var
            tileImages      = [],
            tileArray       = [],
            tileFlippedOver = [];

        start.addEventListener('click', startGame);

        function startGame() {
            messege.innerHTMLs = '';
            if (!gamePlay) {
                gamePlay = true;
            }
            start.style.display = 'none';
            messege.children[0].innerHTML = "Good Luck!";
            score.innerHTML = 'Points: ' + points;
            // build Array for tiles
            buildArray(tileImages);
            tileArray = tileImages.concat(tileImages);
            // shuffle tiles
            shuffleArray(tileArray);
            // build board
            buildBoard();
        }

        function buildArray(array) {
            for (let i = 1; i < 7; i++) {
                array.push(i+'.jpg');
            }
        }

        function shuffleArray(array) {
            for (let i=array.length-1; i>0; i--) {
                randomItem = Math.floor(Math.random()*(i+1));
                valueItem = array[i];
                array[i] = array[randomItem];
                array[randomItem] = valueItem;
            }
            return array;
        }

        function buildBoard() {
            var html = "";
            var x = 0;
            tileArray.forEach(function (ele) {
                x++;
                html += '<div class="gameTile">';
                html += '<img id="cardz' + x + '" src="http://via.placeholder.com/250/000000/ffffff?text=click" onclick="pickCard(' + (x - 1) + ',this)" class="flipImage"></div>';
            });
            gameBoard.innerHTML = html;
        }

        function pickCard(i,t) {
            if (!playLockOut && !isInArray(t.id, tileFlippedOver)) {
                if (flippedCard >= 0) {
                    filpCard(i, t);
                    playLockOut = true;
                    // check to if its a match
                    if (checkSrc(tileFlippedOver[tileFlippedOver.length - 1]) == checkSrc(tileFlippedOver[tileFlippedOver.length - 2])) {
                        messege.innerHTML = 'Match Found!';
                        if (trys === 0) {
                            points += 3
                            trys++
                        } else {
                            points += 1
                            trys++
                        }
                        totalTry += trys;
                        trys = 0;
                        score.innerHTML = 'Points: ' + points;
                        flippedCard = -1;
                        playLockOut = false;
                    }
                    else {
                        trys++;
                        messege.innerHTML = 'No Match';
                        timer = setInterval(hideCard, 1000);
                    }
                }
                else {
                    flippedCard = i;
                    filpCard(i, t);
                }
            } else {
                    if (isInArray(t.id,tileFlippedOver)) {
                        messege.innerHTML = 'Find is Match!'
                    }
                    else {
                        messege.innerHTML = 'Locked Out'
                    }
            }
            if (tileFlippedOver.length === tileArray.length) {
                gameOver();
            }
        }
        function filpCard(i,t) {
            t.src = "https://via.placeholder.com/250/023464/ffffff?text=" + tileArray[i];
            tileFlippedOver.push(t.id);
            console.log(tileFlippedOver);
        }
        function hideCard() {
            for (let i = 0; i < 2; i++) {
                var vid = tileFlippedOver.pop();
                document.getElementById(vid).src = "https://via.placeholder.com/250/000000/ffffff?text=click";
                playLockOut = false;
            }
            clearInterval(timer);
            flippedCard = -1;
            messege.innerHTML = 'Select Again';
        }
        function checkSrc(a) {
            debugger;
            return document.getElementById(a).src;
        }
        function isInArray(value,array) {
            return array.indexOf(value) > -1;
        }
        function gameOver() {
            start.style.display = 'block';
            tileImages = [];
            tileArray = [];
            tileFlippedOver = [];
            gameBoard.innerHTML = '';
            points = 0;
            messege.innerHTML = '<h2>you finish the game:)</h2><br>Total Trying: '+totalTry;
        }

    </script>

</body>
</html>